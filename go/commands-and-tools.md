## Go building binaries for different system

1. it has to have a GOROOT variable setup

2. make sure that your username is owning the GOROOT directory

`sudo chown -R mma $GOROOT`

```bash
cd $GOROOT/src

# 386 arch works both window and linux
export GOARCH=386

# build this for window.
export GOOS=windows

# build this for linux
export GOOS=linux
```

To build any app in windows

```bash
# build this app for window.
GOOS=windows GOARCH=386 go build -o hello.exe

# build this app for linux
GOOS=linux GOARCH=386 go build -o hello-linux

# build this app for mac
go build -o hello-mac
```

## Go commands

```bash
# To run the program, print the output in the console
go run hello.go

# To build the program into binary in the same folder
go build hello.go

# To build the program into binary, put it inside $GOPATH/bin
go install
```

```bash
# omit the filename of the source code file that we
# want to build and the go tool will default to the current package:
go build

# package can also be specified directly:
go build github.com/goinaction/code/chapter3/wordcount

# Instead of a package specifier, we can also use a path shortcut as an argument to most
#/ of the go commands
go build wordcount.go
# or
go build .
```

#### godoc

Generate documentation. It reads documentation directly from Go source files. Keep docs and code in sync when they live together in the same place.

Just write the documentation above the source code itself and `godoc` will extract it along with the code to generate the necessary documentation.

```bash
# dodoc packageName funcName, show the description of that function
godoc cmd/fmt Println
godoc cmd/time Now
```

- Web view

we can use godoc program to start a web server
with a clickable index of Go packages. The godoc web server gives us a fully navigable
web version of the documentation for all the Go source code installed in our system. `godoc -http=:6060`

- our own code comment

it will automatically include our
comments in the Go documentation generated by godoc.
Comments can be started
using either two slashes, or using the slash asterisk style.

```go
/*
This package documentation will be shown before any type or function
documentation is displayed for our package.
...
*/
package usb

// Retrieve connects to the configuration repository and gathers
// various connection settings, usernames, passwords. It returns a
// config struct on success, or an error.
func Retrieve() (config, error) {
// ... omitted
}
```

#### go get

It fetches the github source code and put it into `$GOPATH`, then build the binary.
Note: Repo name must be the same of the folder name and binary name.

```bash
go get github.com/mattma/reddit
```

#### go build

compile it once and save the compiled result for later use, so creates an executable binary file.

- look at some compilerâ€™s optimizations

```bash
# Build your file (here called t.go) passing some gcflags
go build -gcflags=-m t.go
```

- Set the build id using git's SHA

```bash
# get the short version of SHA1 of your latest commit
git rev-parse --short HEAD
```

```go
// example.go
package main

import "fmt"

// compile passing -ldflags "-X main.Build <build sha1>"
var Build string

func main() {
  fmt.Printf("Using build: %s\n", Build)
}
```

```bash
go build -ldflags "-X main.Build a1064bc" example.go

./example  # Using build: a1064bc
```

#### go install

To run current go program to bin directory

#### go list

list packages

```bash
# To see what packages my app imports without standard packages
go list -f '{{join .Deps "\n"}}' | xargs go list -f '{{if not .Standard}}{{.ImportPath}}{{end}}'

# the list to also contain standard packages
go list -f '{{join .Deps "\n"}}' |  xargs go list -f '{{.ImportPath}}'
```

#### go clean

CLean removes object files from package source directories. Executable program is gone.
ex: `go clean hello.go`


#### go vet

it will check our code for common errors.

the types of errors vet can catch:

* Bad parameters in Printf-style function calls
* Method signature errors for common method definitions
* Bad struct tags
* Unkeyed composite literals

#### go fmt

apply and format a predetermined layout to Go source code. type `go fmt` followed by a file or package specification.
The fmt command will automatically format the source code files we specify and save
them

## Popular tools

`Goimports` is a tool that updates your Go import lines, adding missing ones and removing unreferenced ones.
It acts the same as `gofmt` (drop-in replacement) but in addition to code formatting, also fixes imports.

#### Godep

solved the dependency problem by
using a technique called vendoring and import path re-writing. The idea is to copy all the
dependencies into a directory inside the project repo. Then to re-write any import paths
that reference those dependencies by providing the location inside the project itself

godep created a directory called `Godeps`.
The source code for the dependencies that the tooling vendored are located inside another
set of directories called `_workspace/src`.

```go
// Before vendoring
// used the canonical path for the package.
package main
import (
    "bitbucket.org/ww/goautoneg"
    "github.com/beorn7/perks"
)

// After vendoring
// reference the packages which are now physically located on disk inside the project itself.
package main
import (
    "github.ardanstudios.com/myproject/Godeps/_workspace/src/bitbucket.org/ww/goautoneg"
    "github.ardanstudios.com/myproject/Godeps/_workspace/src/github.com/beorn7/perks"
)
```

#### [gb](getgb.io)

gb is a whole new class of build tool being developed by members of the Go community. It is not compatible with GoTool.
